<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Reviews Database</title>
</head>
<body>
    <h1>Test Reviews Database</h1>
    <button onclick="addTestReviews()">Prida≈• testov√© recenzie</button>
    <button onclick="loadAllReviews()">Naƒç√≠ta≈• v≈°etky recenzie</button>
    <div id="output"></div>

    <script src="scripts/supabase.js"></script>
    <script>
        // Ensure Supabase is loaded
        let supabaseClient;
        
        if (typeof createClient !== 'undefined') {
            console.log('Creating Supabase client...');
            supabaseClient = createClient(SHERIFF_SUPABASE.url, SHERIFF_SUPABASE.key);
            console.log('Supabase client created:', supabaseClient);
        } else {
            console.error('Supabase not loaded!');
        }

        async function addTestReviews() {
            if (!supabaseClient) {
                alert('Supabase client not initialized!');
                return;
            }

            const testReviews = [
                {
                    customer_name: 'Jan Nov√°k',
                    rating: 5,
                    review_text: 'V√Ωborn√° re≈°taur√°cia! Jedlo bolo fantastick√© a obsluha veƒæmi mil√°. Urƒçite sa vr√°tim!',
                    is_approved: true
                },
                {
                    customer_name: 'Marie Svobodov√°', 
                    rating: 4,
                    review_text: 'Pekn√© prostredie a chutn√© jedlo. Iba trochu dlh≈°ie ƒçakanie, ale inak spokojnos≈•.',
                    is_approved: true
                },
                {
                    customer_name: 'Petr Dvo≈ô√°k',
                    rating: 5,
                    review_text: 'Najlep≈°√≠ gul√°≈° v meste! Autentick√° atmosf√©ra western re≈°taur√°cie. Odpor√∫ƒçam v≈°etk√Ωm!',
                    is_approved: true
                },
                {
                    customer_name: 'TestBot#1234',
                    rating: 3,
                    review_text: 'Priemern√© jedlo, niƒç zvl√°≈°tne. Ceny s√∫ ok.',
                    discord_user_id: '123456789012345678',
                    discord_username: 'TestBot#1234',
                    is_approved: false
                },
                {
                    customer_name: 'Anna Kratochv√≠lov√°',
                    rating: 5,
                    review_text: 'Skvel√° re≈°taur√°cia s √∫≈æasnou atmosf√©rou! Person√°l bol veƒæmi ochotn√Ω a jedlo chutilo v√Ωborne.',
                    is_approved: true
                }
            ];

            try {
                const { data, error } = await supabaseClient
                    .from('reviews')
                    .insert(testReviews)
                    .select();

                if (error) throw error;

                document.getElementById('output').innerHTML = `
                    <h3>‚úÖ √öspe≈°ne pridan√© ${data.length} testovac√≠ch recenzi√≠</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                console.error('Error adding test reviews:', err);
                document.getElementById('output').innerHTML = `
                    <h3>‚ùå Chyba pri prid√°van√≠ recenzi√≠</h3>
                    <p>${err.message}</p>
                `;
            }
        }

        async function loadAllReviews() {
            if (!supabaseClient) {
                alert('Supabase client not initialized!');
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('reviews')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                document.getElementById('output').innerHTML = `
                    <h3>üìã V≈°etky recenzie (${data.length})</h3>
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <th>Meno</th>
                            <th>Hodnotenie</th>
                            <th>Text</th>
                            <th>Schv√°len√©</th>
                            <th>Discord</th>
                            <th>D√°tum</th>
                        </tr>
                        ${data.map(review => `
                            <tr>
                                <td>${review.customer_name}</td>
                                <td>${'‚≠ê'.repeat(review.rating)}</td>
                                <td style="max-width: 200px;">${review.review_text.substring(0, 100)}...</td>
                                <td>${review.is_approved ? '‚úÖ' : '‚ùå'}</td>
                                <td>${review.discord_username || '-'}</td>
                                <td>${new Date(review.date_created).toLocaleDateString('sk-SK')}</td>
                            </tr>
                        `).join('')}
                    </table>
                `;
            } catch (err) {
                console.error('Error loading reviews:', err);
                document.getElementById('output').innerHTML = `
                    <h3>‚ùå Chyba pri naƒç√≠tavan√≠ recenzi√≠</h3>
                    <p>${err.message}</p>
                `;
            }
        }
    </script>
</body>
</html>